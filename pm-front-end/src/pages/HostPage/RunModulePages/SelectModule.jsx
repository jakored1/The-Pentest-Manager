import { Avatar, Card, Input } from "antd";
import Meta from "antd/es/card/Meta";
import { useEffect, useState } from "react";


function SelectModule({setSelectedModuleName, setSelectedModuleKey, modulesList}) {

    const [searchInput, setSearchInput] = useState('')
    const [filteredResults, setFilteredResults] = useState([])

    const filterModules = (searchValue) => {
        setSearchInput(searchValue)        
    }

    useEffect(() => { // Using use effect to change value of filtered items properly when searchInput changes
        if (searchInput !== '') {
            const filteredData = modulesList.filter((module) => {
                return module.name.toLowerCase().includes(searchInput.toLowerCase())
            })
            setFilteredResults(filteredData)
        } else {
            setFilteredResults(modulesList)
        }
        // eslint-disable-next-line
    }, [searchInput])

    const ModuleObject = ({module}) => {
        return (
            <div style={{ width: '25%' }}>
                <Card
                    style={{
                        marginRight: '20px',
                        marginBottom: '20px',
                        textAlign: 'center',
                        verticalAlign: 'middle'
                    }}
                    hoverable
                    bordered={true}
                    onClick={() => {
                            setSelectedModuleName(module.name);
                            setSelectedModuleKey(module.key);
                        }}
                >
                    <Meta
                        avatar={<Avatar src={module.icon} size={50} />}
                        title={module.name}
                        description={module.description}
                    />
                </Card>
            </div>
        )
    }

    return (
        <div>
            <h1>Select Module</h1>
            <Input
                style={{
                    width: '500px',
                    marginBottom: '20px'
                }}
                placeholder="Find Module"
                onChange={(e) => filterModules(e.target.value)}
            />
            <br />
            <div style={{ display: 'flex', flexDirection: 'row', flexWrap: 'wrap' }}>
                {
                    searchInput.length > 0 ? (
                        filteredResults.map((module) => {
                            return (
                                <ModuleObject module={module} key={module.key} />
                            )
                        })
                    ) : (
                        modulesList.map((module) => {
                            return (
                                <ModuleObject module={module} key={module.key} />
                            )
                        })
                    )
                }
            </div>
        </div>
    )
}

export default SelectModule;