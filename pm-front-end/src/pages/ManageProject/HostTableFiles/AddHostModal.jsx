import { Button, Form, Input, notification } from 'antd';
import { addHostURL } from "../../../components/GlobalParams";
import { SaveOutlined } from '@ant-design/icons';
import axios from 'axios';


function AddHostModal({projectInfo, setIsModalOpen, updateSidebarTabs, getPageInfo}) {

    const addHost = (values) => {  // Create given host
        // Creating valid data for the backend
        let addHostData = {
            hosts: [{
                host_name: values.host_name,
                host_identifiers: values.host_identifiers
            }],
            parent_project_key: projectInfo.project.project_key
        }

        axios.post(addHostURL, addHostData)
        .then((res) => {
            if (res.data === 'Hosts Added') {
                notification.success({
                    message: 'Success',
                    description: "Host Added",
                    placement: 'bottomRight'
                })
                setIsModalOpen(false)
                updateSidebarTabs() // Updating the sidebar tabs
                getPageInfo() // Getting the page info again to reload the table after removing the host
            } else {
                notification.error({
                    message: 'Error',
                    description: res.data,
                    placement: 'bottomRight'
                })
                setIsModalOpen(false)
            }
        })
        .catch((err) => {
            console.log(err)
            setIsModalOpen(false)
        })
        setIsModalOpen(false)
    }

    return (
        <Form
            layout='vertical'
            name='create_host_form'
            onFinish={addHost}
        >
            <Form.Item
                label="Host Name:"
                name="host_name"
                rules={[{
                    required: true,
                    whitespace: true,
                    message: 'Missing host name'
                }]}
                tooltip="A name to represent the host"
            >
                <Input placeholder="My EX's websites server" />
            </Form.Item>
            <Form.Item
                label="Host Identifiers:"
                name="host_identifiers"
                rules={[{
                    required: true,
                    whitespace: true,
                    message: 'Missing host identifiers'
                }]}
                tooltip={<>The ip/social media account/website/domain you want to preform tests on.<br /><br />
                    A host can have multiple addresses (IPs, Domains, etc.)<br />
                    To input multiple addresses for one host, seperate the addresses with a comma (,)<br /><br />
                    Example: 1.1.1.1, example.com, cool.website.org<br /><br />
                    Cases where a host might need multiple addresses:<br />
                    - servers with multiple IP addresses<br />
                    - servers that host multiple domains<br />
                    - entering both the servers IP address and domains<br />
                    - etc.
                    </>}
            >
                <Input placeholder="1.1.1.1 or example.com"/>
            </Form.Item>
            <div style={{ display: 'flex', flexDirection: 'row', marginTop: '40px' }}>
                <Form.Item style={{ marginRight: '8px' }}>
                    <Button type='primary' icon={<SaveOutlined />} htmlType='submit' >
                        Create Host
                    </Button>
                </Form.Item>
                
                <Form.Item>
                    <Button onClick={() => setIsModalOpen(false)} danger>
                        Cancel
                    </Button>
                </Form.Item>
            </div>
        </Form>
    )
}


export default AddHostModal;
