import { useEffect, useState } from 'react';
// eslint-disable-next-line
import { Layout, Menu, theme, Image } from 'antd';  // Attempted to use Image to make a nice image on the sidebar
import reconfigureIcons from './functions/reconfigureIcons';
import SelectionSwitch from './functions/loadPage';
import ConfigureBreadCrumbs from './functions/configureBreadCrumbs';
import logoImage from './images/logo.png';
import axios from 'axios';
import { BACKEND_IP, BACKEND_PORT } from './components/GlobalParams.js'


// General stuff
const { Header, Content, Footer, Sider } = Layout;
const sidebarContentUrl = 'http://'+BACKEND_IP+':'+BACKEND_PORT+'/sidebarContent'


const App = () => {
    
    const [collapsed, setCollapsed] = useState(false);
    const { token: { colorBgContainer }, } = theme.useToken();

    // Handling routing of different tabs
    const [selectedMenuItem, setSelectedMenuItem] = useState('0');
    // Remeber all tabs
    const [tabsHierarchy, setTabsHierarchy] = useState([])

    // Fetching sidebar tabs
    const [items, setItems] = useState([])
    const updateSidebarTabs = () => {
        axios.get(sidebarContentUrl)
        .then((response) => {
            // Set icons
            setItems(reconfigureIcons(response.data))
            // Remeber tabs hierarchy
            setTabsHierarchy(response.data)
        })
        .catch((err) => {
            console.log(err);
        });
    }

    useEffect(() => {
        updateSidebarTabs()
        
    }, []);


    return (
        <Layout style={{ minHeight: '100vh', }}>
            <Sider collapsible collapsed={collapsed} onCollapse={(value) => setCollapsed(value)}>
                <img src={logoImage} 
                    alt='logo' 
                    style={{
                        marginTop: '6%',
                        marginBottom: '5%',
                        marginInline: 'auto',
                        borderRadius: '50%', 
                        width: 50, 
                        height: 50, 
                        background: 'blue', 
                        display: 'block' }}
                />
                {/* <div style={{ marginLeft: '37%', marginTop: '5%', marginBottom: '7px', }}>
                    <Image 
                        style={{
                            
                            borderRadius: '50%',
                            width: 50,
                            height: 50,
                            background: 'blue',
                        }}
                        src={logoImage}
                    />
                </div> */}
                <Menu
                    theme="dark"
                    mode="inline"
                    items={items}
                    selectedKeys={selectedMenuItem}
                    onClick={(e) => setSelectedMenuItem(e.key)}
                />
            </Sider>

            <Layout className="site-layout">
                <Header style={{ padding: 0, background: colorBgContainer, marginBottom: '10px' }} />
                <Content style={{ margin: '0 16px', }} >
                    {ConfigureBreadCrumbs(selectedMenuItem, tabsHierarchy)}
                    <div
                    style={{
                        padding: 24,
                        minHeight: 360,
                        background: colorBgContainer,
                        marginTop: '5px'
                    }} >
                        {SelectionSwitch(selectedMenuItem, updateSidebarTabs, setSelectedMenuItem)}
                    </div>
                </Content>
                <Footer style={{ textAlign: 'center', }} >
                    Pentest Manager v1.0, Created By Jakored 
                </Footer>
            </Layout>
        </Layout>
    );
};

export default App;
